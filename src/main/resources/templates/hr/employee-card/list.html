<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{common/base}">
<head>
    <title>인사카드 관리</title>
</head>

<body>
    <div layout:fragment="content">

                <div class="card mb-3" th:if="${session.LOGIN_USER.sysRole == 'ADMIN' or session.LOGIN_USER.sysRole == 'HR_MNG'}">
		            <div class="card-header">
		                <h5 class="card-title">사원 검색</h5>
		            </div>
		            <div class="card-body">
		                <form id="searchForm" onsubmit="return false;">
		                    <div class="row align-items-end">
		                        <div class="col-md-3">
		                            <label class="form-label">사번 / 성명</label>
		                            <div class="input-group">
		                                <input type="text" class="form-control" id="searchKeyword" placeholder="사번 또는 성명 입력">
		                                <button type="button" class="btn btn-primary">
		                                    <i class="ti ti-search"></i>
		                                </button>
		                            </div>
		                        </div>
		                        <div class="col-md-9 text-muted small pt-2">
		                            * 사번을 입력하고 엔터 또는 조회 버튼을 누르세요.
		                        </div>
		                    </div>
		                </form>
		            </div>
		        </div>
		        
		       
		       <!-- 2. 인사카드 영역 -->
		        <div id="cardArea" class="card">
		            <div class="card-header d-flex justify-content-between align-items-center">
		                <h5 class="card-title">인사 정보</h5>
		                <!-- 버튼 그룹 -->
		                <div class="btn-list">
		                    <!-- 기본 모드 버튼 -->
		                    <button type="button" id="btnEditMode" class="btn btn-primary" onclick="toggleEditMode(true)">
		                        <i class="ti ti-edit me-1"></i> 정보 수정
		                    </button>
		                    
		                    <!-- 수정 모드 버튼 (초기엔 숨김) -->
		                    <div id="editBtnGroup" style="display:none;">
		                        <button type="button" class="btn btn-success" onclick="savePrivInfo()">
		                            <i class="ti ti-device-floppy me-1"></i> 저장
		                        </button>
		                        <button type="button" class="btn btn-secondary" onclick="toggleEditMode(false)">
		                            <i class="ti ti-x me-1"></i> 취소
		                        </button>
		                    </div>
		                </div>
		            </div>
		            
		            <div class="card-body">
		                <form id="editForm">
		                    
		                    <!-- [상단 요약 정보] (Master 테이블 데이터 - 항상 ReadOnly) -->
		                    <div class="row p-3 mb-4 rounded bg-light border">
		                        <div class="col-md-2">
		                            <label class="form-label fw-bold text-muted small">사번</label>
		                            <input type="text" class="form-control-plaintext fw-bold" name="pernr" readonly>
		                        </div>
		                        <div class="col-md-2">
		                            <label class="form-label fw-bold text-muted small">성명</label>
		                            <input type="text" class="form-control-plaintext fw-bold" name="name" readonly>
		                        </div>
		                        <div class="col-md-3">
		                            <label class="form-label fw-bold text-muted small">부서 / 직급 / 직무</label>
		                            <div class="form-control-plaintext">
		                                <span id="viewDeptName">-</span> / 
		                                <span id="viewRankName">-</span> / 
		                                <span id="viewDutyName">-</span>
		                            </div>
		                        </div>
		                        <div class="col-md-2">
		                            <label class="form-label fw-bold text-muted small">입사일</label>
		                            <input type="text" class="form-control-plaintext" name="entryDate" readonly>
		                        </div>
		                        <div class="col-md-2">
		                            <label class="form-label fw-bold text-muted small">재직 상태</label>
		                            <div class="form-control-plaintext pt-6">
								        <span id="viewStatusBadge" class="badge bg-secondary-lt">Unknown</span>
								    </div>
		                        </div>
		                    </div>
		
		                    <!-- 탭 메뉴 -->
		                    <ul class="nav nav-tabs" id="employeeCardTabs" role="tablist">
		                        <li class="nav-item" role="presentation">
		                            <button class="nav-link active" id="tab-basic" data-bs-toggle="tab" data-bs-target="#basicInfo" type="button" role="tab">기본 정보</button>
		                        </li>
		                        <li class="nav-item" role="presentation">
		                            <button class="nav-link" id="tab-join" data-bs-toggle="tab" data-bs-target="#joinInfo" type="button" role="tab">발령 이력</button>
		                        </li>
		                        <li class="nav-item" role="presentation">
		                            <button class="nav-link" id="tab-family" data-bs-toggle="tab" data-bs-target="#familyInfo" type="button" role="tab">가족 정보</button>
		                        </li>
		                    </ul>
		
		                    <!-- 탭 컨텐츠 -->
		                    <div class="tab-content pt-4" id="employeeCardTabsContent">
		                        
		                        <!-- [TAB 1] 기본 정보 (ZHR_EMP_PRIV) -->
		                        <div class="tab-pane fade show active" id="basicInfo" role="tabpanel">
		                            
		                            <!-- 섹션 1: 신상 정보 -->
		                            <h5 class="mb-3 text-primary"><i class="ti ti-id"></i> 신상 정보</h5>
		                            <div class="row g-3 mb-4">
		                                <div class="col-md-3">
		                                    <label class="form-label required">주민등록번호</label>
		                                    <div class="input-group">
		                                        <input type="text" class="form-control" name="ssn" placeholder="뒷자리 마스킹 처리됨" disabled>
		                                    </div>
		                                </div>
		                                <div class="col-md-3">
		                                    <label class="form-label required">생년월일</label>
		                                    <input type="date" class="form-control" name="birthDate" disabled>
		                                </div>
		                                <div class="col-md-2">
		                                    <label class="form-label required">성별</label>
		                                    <select class="form-select" name="gender" disabled>
		                                        <option value="M">남성</option>
		                                        <option value="F">여성</option>
		                                    </select>
		                                </div>
		                                <div class="col-md-2">
		                                    <label class="form-label">국적</label>
		                                    <select class="form-select" name="nationCode" disabled>
		                                        <option th:each="code : ${nationCodeList}" th:value="${code.code}" th:text="${code.name}"></option>
		                                    </select>
		                                </div>
		                                <div class="col-md-2">
		                                    <label class="form-label">장애여부</label>
		                                    <select class="form-select" name="disabilityYn" disabled>
		                                        <option value="N">비대상</option>
		                                        <option value="Y">대상</option>
		                                    </select>
		                                </div>
		                            </div>
		
		                            <!-- 섹션 2: 연락처 및 주소 -->
		                            <h5 class="mb-3 text-primary"><i class="ti ti-map-pin"></i> 연락처 및 주소</h5>
		                            <div class="row g-3 mb-4">
		                                <div class="col-md-3">
		                                    <label class="form-label required">휴대전화</label>
		                                    <input type="tel" class="form-control" oninput="autoHyphenMulti(this)" maxlength="13" name="phoneNo" disabled> 
		                                </div>
		                                <div class="col-md-3">
		                                    <label class="form-label">자택전화</label>
		                                    <input type="tel" class="form-control" oninput="autoHyphenMulti(this)" maxlength="13" name="homeTel" disabled>
		                                </div>
		                                <div class="col-md-6">
		                                    <label class="form-label">개인 이메일</label>
		                                    <input type="email" class="form-control" name="email" disabled>
		                                </div>
		
		                                <div class="col-md-3">
		                                    <label class="form-label">우편번호</label>
		                                    <div class="input-group">
		                                        <input type="text" class="form-control" name="postCode" id="postCode" disabled>
		                                        <button type="button" class="btn btn-outline-primary" id="btnAddrSearch" onclick="execDaumPostcode()" disabled>검색</button>
		                                    </div>
		                                </div>
		                                <div class="col-md-5">
		                                    <label class="form-label required">기본 주소</label>
		                                    <input type="text" class="form-control" name="addrMain" id="addrMain" disabled>
		                                </div>
		                                <div class="col-md-4">
		                                    <label class="form-label">상세 주소</label>
		                                    <input type="text" class="form-control" name="addrDetail" id="addrDetail" disabled>
		                                </div>
		                                <input type="hidden" name="sido" id="sido">
		                                <input type="hidden" name="sigungu" id="sigungu">
		                            </div>
		
		                            <h5 class="mb-3 text-primary"><i class="ti ti-info-circle"></i> 기타 정보</h5>
		                            <div class="row g-3">
		                                <div class="col-md-2">
		                                    <label class="form-label">결혼 상태</label>
		                                    <select class="form-select" name="maritalCode" disabled>
		                                        <option th:each="code : ${maritalCodeList}" th:value="${code.code}" th:text="${code.name}"></option>
		                                    </select>
		                                </div>
		                                <div class="col-md-2">
		                                    <label class="form-label">병역 구분</label>
		                                    <select class="form-select" name="militaryCode" disabled>
		                                        <option th:each="code : ${militaryCodeList}" th:value="${code.code}" th:text="${code.name}"></option>
		                                    </select>
		                                </div>
		                                <div class="col-md-2">
		                                    <label class="form-label">비상연락인</label>
		                                    <input type="text" class="form-control" name="emergencyName" disabled>
		                                </div>
		                                <div class="col-md-2">
		                                    <label class="form-label">관계</label>
		                                    <input type="text" class="form-control" name="emergencyRel" disabled>
		                                </div>
		                                <div class="col-md-4">
		                                    <label class="form-label">비상연락처</label>
		                                    <input type="tel" class="form-control" name="emergencyPhone" oninput="autoHyphenMulti(this)" maxlength="13" disabled>
		                                </div>
		                            </div>
		                        </div>
		                        
		                        <!-- [TAB 2] 발령 이력 (Timeline Template) -->
								<div class="tab-pane fade" id="joinInfo" role="tabpanel">
								    <div class="card">
								        <!-- JS가 데이터를 주입할 컨테이너 -->
								        <div class="card-body schedule-timeline" id="appointTimeline">
								            <!-- 로딩 중 표시 -->
								            <div class="text-center py-5">
								                <div class="spinner-border text-primary" role="status"></div>
								                <div class="mt-2 text-muted">이력을 불러오는 중...</div>
								            </div>
								        </div>
								    </div>
								</div>
		                        
		                        <div class="tab-pane fade" id="familyInfo" role="tabpanel">
		                            <p class="text-muted p-3">가족 정보 탭 준비중...</p>
		                        </div>
		                    </div>
		                </form>
		            </div>
		        </div>
		    </div>
	<th:block layout:fragment="script">
		<script th:inline="javascript">
		/*<![CDATA[*/
        const loginUserPernr = /*[[${session.LOGIN_USER.userId}]]*/ '2018001'; 
        /*]]>*/
        const deptList = /*[[${deptCodeList}]]*/ [];
        const rankList = /*[[${rankCodeList}]]*/ [];
        const dutyList = /*[[${dutyCodeList}]]*/ [];
        const statusList = /*[[${empStatusList}]]*/ [];
        const nationList = /*[[${nationCodeList}]]*/ [];
        const maritalList = /*[[${maritalCodeList}]]*/ [];
        const militaryList = /*[[${militaryCodeList}]]*/ [];
        </script>
        <script src="/assets/js/hr/employee-card.js"></script>
    </th:block> 
</body>
</html>