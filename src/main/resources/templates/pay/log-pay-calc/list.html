<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>급여 항목 계산 이력 추적</title>

    <link rel="shortcut icon" href="/assets/img/favicon.png" type="image/x-icon">
	<link rel="stylesheet" href="/assets/css/bootstrap.min.css">
	<link rel="stylesheet" href="/assets/plugins/tabler-icons/tabler-icons.min.css">
	<link rel="stylesheet" href="/assets/plugins/fontawesome/css/fontawesome.min.css">
	<link rel="stylesheet" href="/assets/plugins/fontawesome/css/all.min.css">
	<link rel="stylesheet" href="/assets/css/dataTables.bootstrap5.min.css">
	<link rel="stylesheet" href="/assets/css/style.css">
	<link rel="stylesheet" href="/assets/css/custom-table.css">
	<link rel="stylesheet" href="/assets/css/select2.min.css">
	<link rel="stylesheet" href="/assets/css/select2-bootstrap-5-theme.min.css">
</head>

<body>
    <div id="global-loader">
    	<div class="page-loader"></div>
    </div>

    <div class="main-wrapper">

        <div class="header">
            <div class="main-header">
                <div class="header-left"><a href="/" class="logo"><img src="/assets/img/logo.svg" alt="Logo"></a></div>
                <a id="toggle_btn" href="javascript:void(0);" class="btn btn-menubar me-1"><i class="ti ti-arrow-bar-to-left"></i></a>
                <a id="mobile_btn" class="mobile_btn" href="#sidebar"><span class="bar-icon"><span></span><span></span><span></span></span></a>
            </div>
        </div>
        
        <div th:replace="~{common/sidebar :: sidebar}"></div>

        <div class="page-wrapper">
            <div class="content">

                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title">검색 조건</h5>
                    </div>
                    <div class="card-body">
                        <form action="/pay/log-pay-calc" method="get" id="searchForm">
                            <div class="row">
                                <div class="col-md-2">
                                    <div class="form-group">
                                        <label>급여월</label>
                                        <select name="payYm" multiple="multiple" class="form-control" id="searchPayYmSelect">
                                        	<option th:each="p : ${searchPayYmList}" th:value="${p}" th:text="${p}" th:selected="${payYm != null && #lists.contains(payYm, p)}"></option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-2">
                                    <div class="form-group">
                                        <label>사번</label>
                                        <select name="empNo" multiple="multiple" class="form-control" id="searchEmployeeSelect">
                                        	<option th:each="e : ${searchEmployeeList}" th:value="${e.pernr}" th:text="|${e.name} (${e.pernr})|" th:selected="${empNo != null && #lists.contains(empNo, e.pernr)}"></option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label>항목 코드</label>
                                        <select name="itemCode" multiple="multiple" class="form-control" id="searchPayItemSelect">
                                        	<option th:each="p : ${searchPayItemList}" th:value="${p.itemCode}" th:text="|${p.itemName} (${p.itemCode})|" th:selected="${itemCode != null && #lists.contains(itemCode, p.itemCode)}"></option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label>차수</label>
                                        <select name="seqNo" multiple="multiple" class="form-control" id="searchSeqNoSelect">
                                        	<option th:each="s : ${searchSeqNoItemList}" th:value="${s}" th:text="${s}" th:selected="${seqNo != null && #lists.contains(seqNo, s)}"></option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-2 d-flex align-items-end">
                                    <div class="form-group w-100 position-relative">
                                        <button type="submit" class="btn btn-primary w-100">조회</button>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title">계산 이력 목록</h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped table-hover datatable-resizable" id="dataTable">
                                <thead class="table-light">
                                    <tr>
                                        <th>급여월</th>
                                        <th>사번</th>
                                        <th>항목코드</th>
                                        <th>차수</th>
                                        <th>단계</th>
                                        <th>설명</th>
                                        <th>기준값</th>
                                        <th>수식</th>
                                        <th>계산결과</th>
                                        <th>절사값</th>
                                        <th>절사방식</th>
                                        <th>출처</th>
                                        <th>비고</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr th:each="log : ${logPayCalc}">
                                        <td th:text="${log.payYm}"></td>
                                        <td th:text="|${log.name} (${log.pernr})|"></td>
                                        <td th:text="|${log.itemName} (${log.itemCode})|"></td>
                                        <td th:text="${log.seqNo}"></td>
                                        <td th:text="${log.stepNo}"></td>
                                        <td th:text="${log.stepDesc}"></td>
                                        <td th:text="${log.baseVal}"></td>
                                        <td th:text="${#strings.abbreviate(log.formula, 50)}"></td>
                                        <td th:text="${log.resultVal}"></td>
                                        <td th:text="${log.roundVal}"></td>
                                        <td th:text="${log.roundType}"></td>
                                        <td th:text="${log.calcSrc}"></td>
                                        <td th:text="${#strings.abbreviate(log.note, 50)}"></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                </div>

            <div th:replace="~{common/footer :: footer}"></div>
        </div>
    </div>

    <script src="/assets/js/jquery-3.7.1.min.js"></script>
	<script src="/assets/js/colResizable-1.6.min.js"></script>
	<script src="/assets/js/bootstrap.bundle.min.js"></script>
	<script src="/assets/js/jquery.slimscroll.min.js"></script>
	<script src="/assets/js/select2.min.js"></script>
	<script src="https://unpkg.com/feather-icons"></script>
	<script src="/assets/js/jquery.dataTables.min.js"></script>
	<script src="/assets/js/dataTables.bootstrap5.min.js"></script>
	<script src="/assets/js/script.js"></script>
	<script src="/assets/js/common-datatable-init.js"></script>
    
    <script type="text/javascript" th:inline="none">
    
    document.addEventListener('DOMContentLoaded', function () {
  		
	    $('#searchPayYmSelect').select2({theme: "bootstrap-5"});
	    $('#searchEmployeeSelect').select2({theme: "bootstrap-5"});
	    $('#searchPayItemSelect').select2({theme: "bootstrap-5"});
	    $('#searchSeqNoSelect').select2({theme: "bootstrap-5"});
	    
	    const tableSpecificOptions = {
                'columns': [
                    // 13개 컬럼 정의
                    null,                // 0. 급여월
                    null,                // 1. 사번
                    null,                // 2. 항목코드
                    { "width": "50px" }, // 3. 차수
                    { "width": "50px" }, // 4. 단계 (ZSTEP_NO)
                    null,                // 5. 설명 (ZSTEP_DESC)
                    null,                // 6. 기준값 (ZBASE_VAL)
                    null,                // 7. 수식 (ZFORMULA)
                    null,                // 8. 계산결과 (ZRESULT_VAL)
                    null,                // 9. 절사값 (ZROUND_VAL)
                    null,                // 10. 절사방식 (ZROUND_TY)
                    null,                // 11. 출처 (ZCALC_SRC)
                    null                 // 12. 비고 (ZNOTE)
                ],
                
                "order": [
                    [ 0, "asc" ], // 급여월
                    [ 1, "asc" ], // 사번
                    [ 2, "asc" ], // 항목코드
                    [ 3, "asc" ], // 차수
                    [ 4, "asc" ]  // 단계 (ZSTEP_NO)
                ], 

                // DataTables 한글화 및 기본 설정 (유지)
                "language": {
                    "emptyTable": "데이터가 없습니다.",
                    "info": "_START_ - _END_ / _TOTAL_ 항목",
                    "infoEmpty": "0 항목",
                    "infoFiltered": "(_MAX_ 항목에서 필터링됨)",
                    "lengthMenu": "_MENU_ 개씩 보기",
                    "loadingRecords": "로딩중...",
                    "processing": "처리중...",
                    "search": "검색: ",
                    "zeroRecords": "일치하는 항목이 없습니다.",
                    "paginate": {
                        "first": "처음",
                        "last": "마지막",
                        "next": "다음",
                        "previous": "이전"
                    }
                },
                "pageLength": 10, 
                "lengthMenu": [ [10, 25, 50, 100, -1], [10, 25, 50, 100, "All"] ] // 페이지 메뉴
            };
	    
	    initializeResizableDataTable('#dataTable',tableSpecificOptions);
	});
    
 	// (요청에 따라 addNew, findDetail, update 관련 async function 모두 제거)

    </script>
</body>
</html>