<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{common/base}">
<head>
	<title>급여 항목 관리</title>
</head>

<body>
	<div layout:fragment="content">

				<div class="card">
					<div class="card-header">
						<h5 class="card-title">검색 조건</h5>
					</div>
					<div class="card-body">
						<div id="pay-item-search-box">
							<form action="/pay/pay-item" method="get">
								<div class="row">
									<div class="col-md-3">
										<div class="form-group">
											<label>항목명</label>
											<select name="itemCode" multiple="multiple" class="form-control" id="searchPayItemSelect">
	                                        	<option th:each="p : ${searchPayItemList}" th:value="${p.itemCode}" th:text="|${p.itemName} (${p.itemCode})|" th:selected="${itemCode != null && #lists.contains(itemCode, p.itemCode)}"></option>
	                                        </select>
										</div>
									</div>
									<div class="col-md-3">
									    <div class="form-group">
									        <label for="itemTypeSelect">항목 유형</label>
									        <select class="form-select" name="itemTypes" id="itemTypeSelect" multiple="multiple">
									            <option value="PAY" th:selected="${itemTypes != null && #lists.contains(itemTypes, 'PAY')}">PAY</option>
									            <option value="DEDUCT" th:selected="${itemTypes != null && #lists.contains(itemTypes, 'DEDUCT')}">DEDUCT</option>
									            <option value="TAX" th:selected="${itemTypes != null && #lists.contains(itemTypes, 'TAX')}">TAX</option>
									            <option value="INSURANCE" th:selected="${itemTypes != null && #lists.contains(itemTypes, 'INSURANCE')}">INSURANCE</option>
									            <option value="BACKPAY" th:selected="${itemTypes != null && #lists.contains(itemTypes, 'BACKPAY')}">BACKPAY</option>
									        </select>
									    </div>
									</div>
									<div class="col-md-3">
										<div class="form-group">
											<label for="search_useYn">사용 여부</label>
											<select class="form-select" name="useYn" id="search_useYn">
												<option value="">전체</option>
												<option value="Y" th:selected="${useYn == 'Y'} ">Y</option>
												<option value="N" th:selected="${useYn == 'N'}">N</option>
											</select>
										</div>
									</div>
									<div class="col-md-3 d-flex align-items-end">
										<div class="form-group w-100">
											<button type="submit" class="btn btn-primary w-100">조회</button>
										</div>
									</div>
								</div>
							</form>
						</div>
					</div>
				</div>

				<div class="card">
					<div class="card-header">
						<h5 class="card-title">항목 목록</h5>
					</div>
					<div class="card-body">
						<div class="table-responsive">
							<table class="table table-striped table-hover datatable-resizable w-100" id="dataTable">
								<thead class="table-light">
									<tr>
										<th>항목코드</th>
										<th>항목명</th>
										<th>유형</th>
										<th>과세</th>
										<th>절사방식</th>
										<th>사용여부</th>
										<th>수정</th>
									</tr>
								</thead>
								<tbody>
									<tr th:each= "z : ${payItem}">
										<td th:text="${z.itemCode}"></td>
										<td th:text="${z.itemName}"></td>
										<td th:text="${z.itemType}"></td>
										<td>
										    <input type="checkbox" class="form-check-input" th:checked="${z.taxYn == 'Y'}" onclick="return false;">
										</td>
										<td th:text="${z.roundType}"></td>
										<td>
										    <input type="checkbox" class="form-check-input" th:checked="${z.useYn == 'Y'}" onclick="return false;">
										</td>
										<td><button class="btn btn-primary edit-btn"  data-bs-toggle="modal" data-bs-target="#editModal" th:data-value="${z.itemCode}">수정</button></td>
									</tr>
								</tbody>
							</table>
						</div>
					</div>
				</div>

				<div class="modal fade" id="addModal" tabindex="-1" aria-labelledby="addModalLabel" aria-hidden="true">
				    <div class="modal-dialog modal-lg modal-dialog-centered">
				        <div class="modal-content">
				            <div class="modal-header bg-light">
				                <h5 class="modal-title" id="addModalLabel"><i class="fas fa-plus-circle me-2"></i>신규 항목 등록</h5>
				                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				            </div>
				            <div class="modal-body">
				                <form id="addForm">
				                    <h6 class="border-bottom pb-2 mb-3 fw-bold text-primary">1. 기본 정보</h6>
				                    <div class="row g-3 mb-4">
				                        <div class="col-md-4">
				                            <label class="form-label small fw-bold">항목코드 <span class="text-danger">*</span></label>
				                            <input type="text" class="form-control" name="itemCode" required="required" maxlength="20" placeholder="예: P001">
				                        </div>
				                        <div class="col-md-4">
				                            <label class="form-label small fw-bold">항목명 <span class="text-danger">*</span></label>
				                            <input type="text" class="form-control" name="itemName" required="required" maxlength="100" placeholder="예: 기본급">
				                        </div>
				                        <div class="col-md-4">
				                            <label class="form-label small fw-bold">유형</label>
				                            <select class="form-select" name="itemType">
				                                <option value="PAY">PAY (지급)</option>
				                                <option value="DEDUCT">DEDUCT (공제)</option>
				                                <option value="INSURANCE">INSURANCE (보험)</option>
				                                <option value="TAX">TAX (세금)</option>
				                                <option value="BACKPAY">BACKPAY (소급)</option>
				                            </select>
				                        </div>
				                    </div>
				
				                    <h6 class="border-bottom pb-2 mb-3 fw-bold text-primary">2. 계산 및 정산 설정</h6>
				                    <div class="row g-3 mb-4">
				                        <div class="col-md-4">
				                            <label class="form-label small fw-bold">과세방식</label>
				                            <select class="form-select" name="taxType" onchange="checkTaxType(this)">
				                                <option value="">선택...</option>
				                                <option value="PERCENT">PERCENT (정률)</option>
				                                <option value="AMOUNT">AMOUNT (정액)</option>
				                            </select>
				                        </div>
				                        <div class="col-md-4">
				                            <label class="form-label small fw-bold">과세비율/금액</label>
				                            <div class="input-group">
				                                <input type="number" step="0.01" class="form-control" min="0" max="999.99" name="taxPercent">
				                                <span class="input-group-text">%</span>
				                            </div>
				                        </div>
				                        <div class="col-md-4">
				                            <label class="form-label small fw-bold">절사방식</label>
				                            <select class="form-select" name="roundType">
				                                <option value="WON">WON (원 단위)</option>
				                                <option value="TEN">TEN (십원 단위)</option>
				                                <option value="HUNDRED">HUNDRED (백원 단위)</option>
				                            </select>
				                        </div>
				                    </div>
				
				                    <div class="bg-light p-3 rounded mb-3">
				                        <h6 class="small fw-bold text-secondary mb-3">3. 적용 옵션</h6>
				                        <div class="row g-3">
				                            <div class="col-md-3 col-6">
				                                <div class="form-check">
				                                    <input type="hidden" value="N" name="taxYn">
				                                    <input class="form-check-input" type="checkbox" value="Y" name="taxYn" id="add_taxYn" checked>
				                                    <label class="form-check-label" for="add_taxYn">과세 여부</label>
				                                </div>
				                            </div>
				                            <div class="col-md-3 col-6">
				                                <div class="form-check">
				                                    <input type="hidden" value="N" name="insuranceYn">
				                                    <input class="form-check-input" type="checkbox" value="Y" name="insuranceYn" id="add_insuranceYn" checked>
				                                    <label class="form-check-label" for="add_insuranceYn">4대보험</label>
				                                </div>
				                            </div>
				                            <div class="col-md-3 col-6">
				                                <div class="form-check">
				                                    <input type="hidden" value="N" name="backPayYn">
				                                    <input class="form-check-input" type="checkbox" value="Y" name="backPayYn" id="add_backPayYn">
				                                    <label class="form-check-label" for="add_backPayYn">소급 적용</label>
				                                </div>
				                            </div>
				                            <div class="col-md-3 col-6">
				                                <div class="form-check">
				                                    <input type="hidden" value="N" name="useYn">
				                                    <input class="form-check-input" type="checkbox" value="Y" name="useYn" id="add_useYn" checked>
				                                    <label class="form-check-label" for="add_useYn">사용 여부</label>
				                                </div>
				                            </div>
				                        </div>
				                    </div>
				
				                    <div class="row">
				                        <div class="col-12">
				                            <label class="form-label small fw-bold">비고</label>
				                            <textarea class="form-control" rows="2" name="note" maxlength="500" placeholder="메모를 입력하세요."></textarea>
				                        </div>
				                    </div>
				                </form>
				            </div>
				            <div class="modal-footer bg-light">
				                <button type="reset" form="addForm" class="btn btn-outline-secondary btn-sm">
				                    <i class="fas fa-redo-alt me-1"></i> 초기화
				                </button>
				                <div class="ms-auto d-flex gap-2">
				                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
				                    <button type="button" class="btn btn-primary" onclick="addNewPayItem()">
				                        <i class="fas fa-save me-1"></i> 저장
				                    </button>
				                </div>
				            </div>
				        </div>
				    </div>
				</div>
				<div class="my-3 text-end">
					<button type="button" id="addButton" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addModal">신규 등록</button>
				</div>
				
				<div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
				    <div class="modal-dialog modal-lg modal-dialog-centered">
				        <div class="modal-content">
				            <div class="modal-header bg-light">
				                <h5 class="modal-title" id="editModalLabel"><i class="fas fa-edit me-2"></i>항목 정보 수정</h5>
				                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				            </div>
				            <div class="modal-body">
				                <form id="editPayItemForm">
				                    <h6 class="border-bottom pb-2 mb-3 fw-bold text-primary">1. 기본 정보</h6>
				                    <div class="row g-3 mb-4">
				                        <div class="col-md-4">
				                            <label class="form-label small fw-bold">항목코드</label>
				                            <input type="text" class="form-control bg-light" name="itemCode" readonly>
				                        </div>
				                        <div class="col-md-4">
				                            <label class="form-label small fw-bold">항목명 <span class="text-danger">*</span></label>
				                            <input type="text" class="form-control" name="itemName">
				                        </div>
				                        <div class="col-md-4">
				                            <label class="form-label small fw-bold">유형</label>
				                            <input type="text" class="form-control bg-light" name="itemType" readonly>
				                        </div>
				                    </div>
				
				                    <h6 class="border-bottom pb-2 mb-3 fw-bold text-primary">2. 계산 및 정산 설정</h6>
				                    <div class="row g-3 mb-4">
				                        <div class="col-md-4">
				                            <label class="form-label small fw-bold">과세방식</label>
				                            <select class="form-select" name="taxType" onchange="checkTaxType(this)">
				                                <option value="">선택...</option>
				                                <option value="PERCENT">PERCENT (정률)</option>
				                                <option value="AMOUNT">AMOUNT (정액)</option>
				                            </select>
				                        </div>
				                        <div class="col-md-4">
				                            <label class="form-label small fw-bold">과세비율/금액</label>
				                            <div class="input-group">
				                                <input type="number" step="0.01" class="form-control" min="0" max="999.99" name="taxPercent">
				                                <span class="input-group-text">%</span>
				                            </div>
				                        </div>
				                        <div class="col-md-4">
				                            <label class="form-label small fw-bold">절사방식</label>
				                            <select class="form-select" name="roundType">
				                                <option value="WON">WON (원 단위)</option>
				                                <option value="TEN">TEN (십원 단위)</option>
				                                <option value="HUNDRED">HUNDRED (백원 단위)</option>
				                            </select>
				                        </div>
				                    </div>
				
				                    <div class="bg-light p-3 rounded mb-3">
				                        <h6 class="small fw-bold text-secondary mb-3">3. 적용 옵션</h6>
				                        <div class="row g-3">
				                            <div class="col-md-3 col-6">
				                                <div class="form-check">
				                                    <input type="hidden" value="N" name="taxYn">
				                                    <input class="form-check-input" type="checkbox" value="Y" name="taxYn" id="edit_taxYn">
				                                    <label class="form-check-label" for="edit_taxYn">과세 여부</label>
				                                </div>
				                            </div>
				                            <div class="col-md-3 col-6">
				                                <div class="form-check">
				                                    <input type="hidden" value="N" name="insuranceYn">
				                                    <input class="form-check-input" type="checkbox" value="Y" name="insuranceYn" id="edit_insuranceYn">
				                                    <label class="form-check-label" for="edit_insuranceYn">4대보험</label>
				                                </div>
				                            </div>
				                            <div class="col-md-3 col-6">
				                                <div class="form-check">
				                                    <input type="hidden" value="N" name="backPayYn">
				                                    <input class="form-check-input" type="checkbox" value="Y" name="backPayYn" id="edit_backPayYn">
				                                    <label class="form-check-label" for="edit_backPayYn">소급 적용</label>
				                                </div>
				                            </div>
				                            <div class="col-md-3 col-6">
				                                <div class="form-check">
				                                    <input type="hidden" value="N" name="useYn">
				                                    <input class="form-check-input" type="checkbox" value="Y" name="useYn" id="edit_useYn">
				                                    <label class="form-check-label" for="edit_useYn">사용 여부</label>
				                                </div>
				                            </div>
				                        </div>
				                    </div>
				
				                    <div class="row">
				                        <div class="col-12">
				                            <label class="form-label small fw-bold">비고</label>
				                            <textarea class="form-control" rows="2" name="note" maxlength="500"></textarea>
				                        </div>
				                    </div>
				                </form>
				            </div>
				            <div class="modal-footer bg-light">
				                <div class="ms-auto d-flex gap-2">
				                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
				                    <button type="button" class="btn btn-primary" onclick="updatePayItem()">
				                        <i class="fas fa-check me-1"></i> 변경사항 저장
				                    </button>
				                </div>
				            </div>
				        </div>
				    </div>
				</div>
	</div>
	<th:block layout:fragment="script">
        <script src="/assets/js/pay/pay-item.js"></script>
    </th:block>
</body>

</html>